# AmneziaWG Docker Server Configuration
# Docker-реализация: asychin (https://github.com/asychin)
# Оригинальный VPN сервер: AmneziaWG Team (https://github.com/amnezia-vpn)
# Скопируйте этот файл в .env и настройте под ваши нужды

# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ СЕРВЕРА
# ============================================================================

# Имя интерфейса AmneziaWG (рекомендуется оставить awg0)
AWG_INTERFACE=awg0

# Порт прослушивания UDP (51820 - стандартный, можно изменить для обхода блокировок)
# Популярные альтернативы: 443 (HTTPS), 53 (DNS), 1194 (OpenVPN)
AWG_PORT=51820

# Внутренняя сеть VPN (не должна пересекаться с локальными сетями)
AWG_NET=10.13.13.0/24

# IP адрес сервера в VPN сети
AWG_SERVER_IP=10.13.13.1

# DNS серверы для клиентов (разделенные запятой)
# Рекомендуется: 8.8.8.8,8.8.4.4 (Google) или 1.1.1.1,1.0.0.1 (Cloudflare)
AWG_DNS=8.8.8.8,8.8.4.4

# ============================================================================
# ПУБЛИЧНЫЙ IP СЕРВЕРА (АВТООПРЕДЕЛЕНИЕ)
# ============================================================================

# Публичный IP адрес вашего сервера для клиентских конфигураций
# 
# ВАРИАНТЫ НАСТРОЙКИ:
# 1. auto (по умолчанию) - автоматическое определение через внешние сервисы
# 2. Конкретный IP - принудительно установить определенный адрес
# 3. Не задано - автоопределение как с "auto"
#
# АВТООПРЕДЕЛЕНИЕ IP:
# Система последовательно опрашивает надежные сервисы в следующем порядке:
# • https://eth0.me           (быстрый и надежный)
# • https://ipv4.icanhazip.com (резервный)
# • https://api.ipify.org     (популярный API)
# • https://checkip.amazonaws.com (AWS сервис)
# • https://ipinfo.io/ip      (детальная геоинформация)
# • https://ifconfig.me/ip    (классический сервис)
# • http://whatismyip.akamai.com (CDN провайдер)
# • http://i.pn               (минималистичный)
#
# При недоступности всех сервисов выводится предупреждение с инструкциями.
#
# ПРИМЕРЫ:
SERVER_PUBLIC_IP=auto                    # Автоопределение (рекомендуется)
# SERVER_PUBLIC_IP=203.0.113.123        # Конкретный IP
# SERVER_PUBLIC_IP=                     # Пустое значение = автоопределение

# ============================================================================
# НАСТРОЙКИ КЛИЕНТОВ
# ============================================================================

# Подсеть для клиентов (обычно совпадает с AWG_NET)
CLIENTS_SUBNET=10.13.13.0/24

# Разрешенные IP для маршрутизации через VPN
# 0.0.0.0/0 - весь трафик через VPN
# 192.168.1.0/24 - только локальная сеть
ALLOWED_IPS=0.0.0.0/0

# ============================================================================
# ПАРАМЕТРЫ ОБФУСКАЦИИ AMNEZIAWG ДЛЯ ОБХОДА DPI
# ============================================================================
# Эти параметры маскируют VPN трафик под обычный HTTPS трафик,
# что помогает обходить системы глубокой инспекции пакетов (DPI)

# Jc: Интенсивность джиттера (рекомендуется: 3-15)
AWG_JC=7

# Jmin/Jmax: Размер "мусорных" пакетов для маскировки (байты)
# Jmin должен быть меньше Jmax. Большие значения = лучшая маскировка + больше трафика
AWG_JMIN=50
AWG_JMAX=1000

# S1/S2: Размеры заголовков для имитации HTTPS (байты)
# Типичные значения для HTTPS: S1=86, S2=574
AWG_S1=86
AWG_S2=574

# H1-H4: Хеш-функции для обфускации (1-4)
# Рекомендуется использовать разные значения
AWG_H1=1
AWG_H2=2
AWG_H3=3
AWG_H4=4

# ============================================================================
# АЛЬТЕРНАТИВНЫЕ НАСТРОЙКИ ДЛЯ СТРОГОГО DPI
# ============================================================================
# Если стандартные настройки не помогают обходить блокировки, попробуйте:
#
# Усиленная обфускация:
# AWG_JC=12
# AWG_JMIN=75
# AWG_JMAX=1500
# AWG_S1=96
# AWG_S2=684
#
# Имитация DNS:
# AWG_PORT=53
# AWG_JC=5
# AWG_JMIN=32
# AWG_JMAX=512
#
# Имитация HTTPS:
# AWG_PORT=443
# AWG_S1=86
# AWG_S2=574
# ============================================================================

# ============================================================================
# НАСТРОЙКИ МОНИТОРИНГА И ХЕЛСЧЕКА
# ============================================================================

# Таймаут для выполнения проверок хелсчека (секунды)
# HEALTHCHECK_TIMEOUT=5

# Подробное логирование хелсчека (true/false)
# Включите для отладки проблем с хелсчеком
# HEALTHCHECK_VERBOSE=false

# ============================================================================
# ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ
# ============================================================================

# Принудительное отключение iptables (true/false)
# Используется в CI/CD окружениях или ограниченных средах где iptables недоступен
# ВАЖНО: При отключении iptables NAT и маршрутизация должны быть настроены на хосте!
# AWG_DISABLE_IPTABLES=false

# ============================================================================
# ВЕБ-ИНТЕРФЕЙС И API (v2.0.0+)
# ============================================================================
#
# НОВОЕ В v2.0.0:
# • Веб-интерфейс управления клиентами (React + TypeScript)
# • REST API для автоматизации
# • PostgreSQL база данных для хранения клиентов
# • QR коды для быстрой настройки мобильных устройств
# • Авторизация API через Bearer токены
#
# ДОСТУП К ИНТЕРФЕЙСУ:
# После запуска откройте в браузере: http://ваш-сервер-ip:8080
# API документация доступна по адресу: http://ваш-сервер-ip:8080/docs

# Порт для доступа к веб-интерфейсу (по умолчанию 8080)
# Этот порт используется для:
# • Веб-интерфейс управления клиентами: http://server:8080
# • REST API endpoints: http://server:8080/api/*
# • Документация: http://server:8080/docs
# 
# ВАЖНО: Если меняете порт, не забудьте открыть его в файерволе!
# Пример: ufw allow 8080/tcp
WEB_PORT=8080

# ============================================================================
# БАЗА ДАННЫХ POSTGRESQL
# ============================================================================
#
# PostgreSQL запускается в Docker контейнере и используется для хранения:
# • Имена клиентов и IP адреса
# • Публичные ключи
# • Время создания и последнего подключения
# • Статус активности
#
# Все данные хранятся в Docker volume 'postgres-data' и сохраняются при перезапуске

# Имя базы данных
POSTGRES_DB=amneziawg

# Пользователь базы данных
POSTGRES_USER=amneziawg

# Пароль базы данных
# ⚠️ ВАЖНО: Измените этот пароль на безопасный!
# Генерация безопасного пароля: openssl rand -base64 32
POSTGRES_PASSWORD=change_this_password_to_secure_one

# Метод аутентификации (рекомендуется scram-sha-256 для безопасности)
# POSTGRES_HOST_AUTH_METHOD=scram-sha-256

# Аргументы инициализации базы данных
# POSTGRES_INITDB_ARGS=-E UTF8 --locale=C

# ============================================================================
# НАСТРОЙКИ ПРОИЗВОДИТЕЛЬНОСТИ POSTGRESQL (ОПЦИОНАЛЬНО)
# ============================================================================
#
# По умолчанию используются оптимизированные значения для малых/средних VPN серверов.
# Раскомментируйте и измените если нужна дополнительная настройка.

# Shared Buffers - память для кэширования данных (рекомендуется 25% RAM)
# Для сервера с 1GB RAM: 256MB, с 2GB: 512MB, с 4GB: 1GB
# PG_SHARED_BUFFERS=128MB

# Максимальное количество одновременных подключений
# PG_MAX_CONNECTIONS=100

# Work Memory - память на операцию сортировки/хеширования
# PG_WORK_MEM=4MB

# Maintenance Work Memory - память для VACUUM, CREATE INDEX и т.д.
# PG_MAINTENANCE_WORK_MEM=64MB

# Effective Cache Size - оценка памяти доступной для кэша (рекомендуется 50-75% RAM)
# PG_EFFECTIVE_CACHE_SIZE=512MB

# Checkpoint Completion Target - распределение нагрузки записи (0.5-0.9)
# PG_CHECKPOINT_COMPLETION_TARGET=0.9

# WAL Buffers - буферы журнала транзакций
# PG_WAL_BUFFERS=16MB

# Default Statistics Target - точность статистики планировщика (10-500)
# PG_DEFAULT_STATISTICS_TARGET=100

# Random Page Cost - стоимость случайного чтения (для SSD: 1.1, для HDD: 4.0)
# PG_RANDOM_PAGE_COST=1.1

# Effective IO Concurrency - параллельные I/O операции (для SSD: 200, для HDD: 2)
# PG_EFFECTIVE_IO_CONCURRENCY=200

# Min WAL Size - минимальный размер журнала
# PG_MIN_WAL_SIZE=1GB

# Max WAL Size - максимальный размер журнала
# PG_MAX_WAL_SIZE=4GB

# Max Worker Processes - максимум фоновых процессов
# PG_MAX_WORKER_PROCESSES=4

# Max Parallel Workers Per Gather - параллельные воркеры на запрос
# PG_MAX_PARALLEL_WORKERS_PER_GATHER=2

# Max Parallel Workers - максимум параллельных воркеров
# PG_MAX_PARALLEL_WORKERS=4

# Max Parallel Maintenance Workers - параллельные воркеры для обслуживания
# PG_MAX_PARALLEL_MAINTENANCE_WORKERS=2

# Shared Memory Size - размер разделяемой памяти (должен быть >= shared_buffers)
# PG_SHM_SIZE=128MB

# Режим работы Node.js
# production - для продакшена (минимум логов, оптимизация)
# development - для разработки (подробные логи, hot-reload)
NODE_ENV=production

# ============================================================================
# БЕЗОПАСНОСТЬ (КРИТИЧНО ДЛЯ ПРОДАКШЕНА!)
# ============================================================================

# ⚠️ ВАЖНО: Установите API_SECRET для защиты API endpoints в продакшене!
# 
# БЕЗ API_SECRET:
# - API работает в DEMO режиме (открыта для всех запросов)
# - Любой может добавлять/удалять клиентов через API
# - ⛔ НЕБЕЗОПАСНО для публичного доступа
#
# С API_SECRET:
# - Требуется Bearer токен в заголовке Authorization
# - Защита от несанкционированного доступа
# - ✅ Рекомендуется для production
#
# Генерация безопасного секрета:
# openssl rand -base64 32
#
# Использование в запросах:
# curl -H "Authorization: Bearer ваш_секрет" http://server:8080/api/clients
#
# ВАЖНО: Минимум 32 символа!
API_SECRET=

# Дополнительная защита веб-интерфейса через nginx basic auth
# Рекомендуется настроить обратный прокси (nginx) с базовой авторизацией
# Пример конфигурации nginx:
#
# location / {
#     auth_basic "AmneziaWG Admin";
#     auth_basic_user_file /etc/nginx/.htpasswd;
#     proxy_pass http://localhost:8080;
# }

# ============================================================================