# üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å AmneziaWG VPN Server v2.0.0

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ VPN —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ú–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–º–æ–¥–µ–ª—å-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
2. [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è API](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-api)
3. [–ó–∞—â–∏—Ç–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](#–∑–∞—â–∏—Ç–∞-–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-postgresql)
5. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å VPN —Ç—Ä–∞—Ñ–∏–∫–∞](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-vpn-—Ç—Ä–∞—Ñ–∏–∫–∞)
6. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–¥–ª—è-production)

---

## –ú–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

AmneziaWG v2.0.0 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é –º–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Frontend)          ‚îÇ
‚îÇ         React + TypeScript              ‚îÇ
‚îÇ       –ù–ï–¢ –í–°–¢–†–û–ï–ù–ù–û–ô –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         REST API (Backend)              ‚îÇ
‚îÇ    –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑       ‚îÇ
‚îÇ         API_SECRET (Bearer Token)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      PostgreSQL Database                ‚îÇ
‚îÇ    –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### üîì DEMO –†–µ–∂–∏–º (–ù–ï –¥–ª—è production!)
- **–£—Å–ª–æ–≤–∏—è**: `API_SECRET` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –ø—É—Å—Ç–æ–π
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: API –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–†–∏—Å–∫–∏**: ‚ö†Ô∏è –õ—é–±–æ–π –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º–∏!

#### üîí Production –†–µ–∂–∏–º (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–£—Å–ª–æ–≤–∏—è**: `API_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –¢—Ä–µ–±—É–µ—Ç—Å—è Bearer —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü—É–±–ª–∏—á–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã, VPS –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
- **–ó–∞—â–∏—Ç–∞**: ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è API

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API_SECRET

#### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π 32-–±–∞–π—Ç–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç (base64)
openssl rand -base64 32

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—É—é –ø–∞—Ä–æ–ª—å–Ω—É—é —Ñ—Ä–∞–∑—É (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
# –ü—Ä–∏–º–µ—Ä: "my-super-secret-api-key-2024-amneziawg-production"
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `.env` —Ñ–∞–π–ª

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ .env
nano .env

# –î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É
API_SECRET=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç_–¥–ª–∏–Ω–æ–π_–º–∏–Ω–∏–º—É–º_32_—Å–∏–º–≤–æ–ª–∞
```

#### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å
docker compose down
docker compose up -d --build web
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

#### cURL –∑–∞–ø—Ä–æ—Å—ã

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
curl -H "Authorization: Bearer –≤–∞—à_API_SECRET" \
     http://your-server:8080/api/clients

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
curl -X POST \
     -H "Authorization: Bearer –≤–∞—à_API_SECRET" \
     -H "Content-Type: application/json" \
     -d '{"name":"john"}' \
     http://your-server:8080/api/clients
```

#### JavaScript/TypeScript (fetch)

```typescript
const API_SECRET = '–≤–∞—à_API_SECRET';

async function getClients() {
  const response = await fetch('http://your-server:8080/api/clients', {
    headers: {
      'Authorization': `Bearer ${API_SECRET}`
    }
  });
  return response.json();
}
```

#### Python (requests)

```python
import requests

API_SECRET = '–≤–∞—à_API_SECRET'
headers = {'Authorization': f'Bearer {API_SECRET}'}

response = requests.get('http://your-server:8080/api/clients', headers=headers)
clients = response.json()
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ó–∞–ø—Ä–æ—Å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
curl http://your-server:8080/api/clients

# DEMO —Ä–µ–∂–∏–º: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
# Production —Ä–µ–∂–∏–º: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 Unauthorized
```

---

## –ó–∞—â–∏—Ç–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### ‚ö†Ô∏è –í–∞–∂–Ω–æ!

**–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ù–ï –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!**

–õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–º–µ—é—â–∏–π –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É (http://server:8080), –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å VPN –∫–ª–∏–µ–Ω—Ç–∞–º–∏ **–µ—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å API_SECRET**.

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã

#### 1. Nginx Reverse Proxy —Å Basic Auth (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```nginx
# /etc/nginx/sites-available/amneziawg
server {
    listen 80;
    server_name vpn.example.com;

    # HTTP Basic Authentication
    auth_basic "AmneziaWG Admin Panel";
    auth_basic_user_file /etc/nginx/.htpasswd;

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
    location /ws {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ apache2-utils (Debian/Ubuntu)
sudo apt-get install apache2-utils

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin
sudo htpasswd -c /etc/nginx/.htpasswd admin

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx
sudo nginx -t && sudo systemctl reload nginx
```

#### 2. VPN-Only Access

–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ VPN:

```yaml
# docker-compose.yml
services:
  web:
    ports:
      # –ü—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É VPN –∞–¥—Ä–µ—Å—É –≤–º–µ—Å—Ç–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ
      - "10.13.13.1:8080:5000"
```

–¢–µ–ø–µ—Ä—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ VPN: http://10.13.13.1:8080

#### 3. Firewall Rules (UFW)

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö IP
sudo ufw allow from 203.0.113.10 to any port 8080 proto tcp

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ VPN —Å–µ—Ç—å
sudo ufw allow from 10.13.13.0/24 to any port 8080 proto tcp
```

#### 4. SSH Tunnel

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ SSH
ssh -L 8080:localhost:8080 user@your-server

# –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ localhost:8080 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **–Ω–∞–¥–µ–∂–Ω—ã–µ** –ø–∞—Ä–æ–ª–∏ –≤ `.env`:

```bash
POSTGRES_DB=amneziawg
POSTGRES_USER=amneziawg
POSTGRES_PASSWORD=–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ_–æ—á–µ–Ω—å_–¥–ª–∏–Ω–Ω—ã–π_—Å–ª—É—á–∞–π–Ω—ã–π_–ø–∞—Ä–æ–ª—å
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è:**

```bash
# 32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å
openssl rand -base64 32
```

### –ò–∑–æ–ª—è—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ **—Ç–æ–ª—å–∫–æ** –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏ `amneziawg-net` –∏ –ù–ï —ç–∫—Å–ø–æ–Ω–∏—Ä—É–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É.

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ PostgreSQL:

```yaml
# docker-compose.yml (–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è production!)
services:
  postgres:
    ports:
      - "127.0.0.1:5432:5432"  # –¢–æ–ª—å–∫–æ localhost
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker exec amneziawg-db pg_dump -U amneziawg amneziawg > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
docker exec -i amneziawg-db psql -U amneziawg amneziawg < backup.sql
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å VPN —Ç—Ä–∞—Ñ–∏–∫–∞

### –û–±—Ñ—É—Å–∫–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ (DPI Bypass)

AmneziaWG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ñ—É—Å–∫–∞—Ü–∏–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ (DPI):

```bash
# env.example
AWG_JC=7          # –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –¥–∂–∏—Ç—Ç–µ—Ä–∞
AWG_JMIN=50       # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä "–º—É—Å–æ—Ä–Ω—ã—Ö" –ø–∞–∫–µ—Ç–æ–≤
AWG_JMAX=1000     # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä "–º—É—Å–æ—Ä–Ω—ã—Ö" –ø–∞–∫–µ—Ç–æ–≤
AWG_S1=86         # –†–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ HTTPS
AWG_S2=574        # –†–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ HTTPS
AWG_H1=1          # –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è #1
AWG_H2=2          # –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è #2
AWG_H3=3          # –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è #3
AWG_H4=4          # –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è #4
```

### –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π

–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤:
- `/app/config/` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- `/app/clients/` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**

```bash
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è:
chmod 700 /app/config
chmod 700 /app/clients
umask 077

# –ù–∞ —Ö–æ—Å—Ç–µ:
sudo chown -R root:root config/ clients/
sudo chmod 700 config/ clients/
```

**API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏!**

–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑:
- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ö–æ–º–∞–Ω–¥—ã `make client-config name=john`

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Production

### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `API_SECRET` (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- [ ] –ù–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å PostgreSQL
- [ ] Nginx reverse proxy —Å Basic Auth
- [ ] HTTPS —Å Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- [ ] Firewall (UFW/iptables) –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + –∫–æ–Ω—Ñ–∏–≥–∏)

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- [ ] VPN-only –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã (Prometheus/Grafana)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ API
- [ ] –†–æ—Ç–∞—Ü–∏—è API_SECRET –∫–∞–∂–¥—ã–µ 3-6 –º–µ—Å—è—Ü–µ–≤
- [ ] –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ nginx + TOTP

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
- [ ] Fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- [ ] WAF (Web Application Firewall)
- [ ] IDS/IPS (Intrusion Detection/Prevention System)

### HTTPS Setup (Let's Encrypt)

```nginx
server {
    listen 443 ssl http2;
    server_name vpn.example.com;

    ssl_certificate /etc/letsencrypt/live/vpn.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/vpn.example.com/privkey.pem;

    # Modern SSL Configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers off;

    auth_basic "AmneziaWG Admin";
    auth_basic_user_file /etc/nginx/.htpasswd;

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# HTTP -> HTTPS redirect
server {
    listen 80;
    server_name vpn.example.com;
    return 301 https://$host$request_uri;
}
```

### Fail2ban –¥–ª—è API

```bash
# /etc/fail2ban/filter.d/amneziawg-api.conf
[Definition]
failregex = ^.*"GET /api/.*" 401.*from <HOST>
ignoreregex =

# /etc/fail2ban/jail.d/amneziawg.conf
[amneziawg-api]
enabled = true
port = http,https
filter = amneziawg-api
logpath = /var/log/nginx/access.log
maxretry = 5
findtime = 600
bantime = 3600
```

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤
docker compose pull
docker compose up -d

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AmneziaWG –ø—Ä–æ–µ–∫—Ç–∞
make update
```

---

## –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo netstat -tulpn | grep LISTEN

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã —Ç–æ–ª—å–∫–æ:
# - 51820/udp (VPN)
# - 22/tcp (SSH)
# - 80/tcp, 443/tcp (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ nginx)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API_SECRET
docker exec amneziawg-web printenv | grep API_SECRET

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ - —Ä–µ–∂–∏–º DEMO (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# API –ª–æ–≥–∏
docker logs amneziawg-web

# VPN —Å–µ—Ä–≤–µ—Ä –ª–æ–≥–∏
docker logs amneziawg-server

# Nginx access log
sudo tail -f /var/log/nginx/access.log
```

---

## –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö

–ï—Å–ª–∏ –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞:

1. **–ù–ï** –ø—É–±–ª–∏–∫—É–π—Ç–µ –µ—ë –ø—É–±–ª–∏—á–Ω–æ
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–µ—Ç–∞–ª–∏ –Ω–∞ email: security@example.com
3. –î–∞–π—Ç–µ –Ω–∞–º 90 –¥–Ω–µ–π –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è

---

## –†–µ—Å—É—Ä—Å—ã

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Docker Security Best Practices](https://docs.docker.com/engine/security/)
- [Nginx Security Headers](https://securityheaders.com/)
- [Let's Encrypt](https://letsencrypt.org/)
- [WireGuard Security](https://www.wireguard.com/)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-11-23  
**–í–µ—Ä—Å–∏—è:** 2.0.0
