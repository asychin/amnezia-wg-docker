# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Git Submodules

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `./quickstart.sh` –∏–ª–∏ `make build` –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:

```
failed to solve: failed to compute cache key: "/amneziawg-tools": not found
```

**–ü—Ä–∏—á–∏–Ω–∞:** Git submodules (amneziawg-go –∏ amneziawg-tools) –Ω–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–µ–ø–æ–ª–Ω–æ—Å—Ç—å—é.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è submodules (–±—ã—Å—Ç—Ä–æ)

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (`~/wg`):

```bash
# 1. –î–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö submodules
git submodule deinit -f amneziawg-go amneziawg-tools

# 2. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
rm -rf .git/modules/amneziawg-go .git/modules/amneziawg-tools
rm -rf amneziawg-go amneziawg-tools

# 3. –ó–∞–≥—Ä—É–∑–∫–∞ submodules –∑–∞–Ω–æ–≤–æ
git submodule update --init --recursive

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
ls -la amneziawg-go/go.mod        # –î–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
ls -la amneziawg-tools/src/        # –î–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

# 5. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ - —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make build

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å VPN
make up
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∑–∞–Ω–æ–≤–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–≠—Ç–æ —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±:

```bash
# 1. –í—ã–π—Ç–∏ –∏–∑ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd ..

# 2. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø .env –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
cp wg/.env wg-env-backup 2>/dev/null

# 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –∫–æ–ø–∏—é
rm -rf wg

# 4. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å --recursive —Ñ–ª–∞–≥–æ–º
git clone --recursive https://github.com/YOUR_USERNAME/amnezia-wg-docker.git wg

# –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_USERNAME –Ω–∞ –≤–∞—à GitHub username –∏–ª–∏ URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

# 5. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd wg

# 6. –û–±–Ω–æ–≤–∏—Ç—å submodules –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π
git submodule update --remote --recursive

# 7. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å .env –µ—Å–ª–∏ –±—ã–ª –±—ç–∫–∞–ø
cp ../wg-env-backup .env 2>/dev/null

# 8. –ó–∞–ø—É—Å—Ç–∏—Ç—å quickstart –∏–ª–∏ build
./quickstart.sh

# –ò–õ–ò –≤—Ä—É—á–Ω—É—é:
make build
make up
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª—é–±–æ–≥–æ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# Submodules –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–∞–π–ª—ã
find amneziawg-go -name "*.go" | wc -l       # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 100
find amneziawg-tools -name "*.c" | wc -l     # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 10

# –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
ls -lh amneziawg-go/go.mod                    # ~400 –±–∞–π—Ç
ls -lh amneziawg-tools/src/Makefile           # ~10KB
```

–ï—Å–ª–∏ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ - –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã!

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied" –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

```bash
# –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å sudo
sudo rm -rf .git/modules/amneziawg-go .git/modules/amneziawg-tools
sudo rm -rf amneziawg-go amneziawg-tools
```

### –ü—Ä–æ–±–ª–µ–º–∞: Submodules –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—É—Å—Ç—ã–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .gitmodules
cat .gitmodules

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
# [submodule "amneziawg-go"]
#     path = amneziawg-go
#     url = https://github.com/amnezia-vpn/amneziawg-go.git
# [submodule "amneziawg-tools"]
#     path = amneziawg-tools
#     url = https://github.com/amnezia-vpn/amneziawg-tools.git

# –ï—Å–ª–∏ .gitmodules –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "fatal: not a git repository"

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –≤—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –±–µ–∑ .git –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ git clone)

---

## üìù –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ quickstart.sh

–í –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ `quickstart.sh`:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ `.git` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –Ω–æ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `amneziawg-go/go.mod`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `amneziawg-tools/src/`
- ‚úÖ –í—ã–¥–∞–µ—Ç —á–µ—Ç–∫—É—é –æ—à–∏–±–∫—É –µ—Å–ª–∏ submodules –ø—É—Å—Ç—ã–µ

–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –º–æ–≥–ª–∞ —Å–æ–æ–±—â–∞—Ç—å "‚úÖ Submodules –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã" –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –ø—É—Å—Ç—ã–º–∏.

---

## üöÄ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ submodules

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make build

# –ó–∞–ø—É—Å–∫ VPN-only (v1.x —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
make up

# –ò–õ–ò –∑–∞–ø—É—Å–∫ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
make up-web

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
make status

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
make client-add name=john
make client-qr name=john
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **README.md** - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **BACKWARD_COMPATIBILITY.md** - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å v1.x
- **MIGRATION.md** - –ú–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π

---

## üí° –°–æ–≤–µ—Ç

**–í—Å–µ–≥–¥–∞ –∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —Ñ–ª–∞–≥–æ–º `--recursive`:**

```bash
git clone --recursive https://github.com/YOUR_USERNAME/amnezia-wg-docker.git
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å–µ submodules –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏!
